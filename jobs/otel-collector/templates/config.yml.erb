receivers:
  prometheus:
    config:
      scrape_configs:
      - job_name: 'otel-collector'
        scrape_interval: 5s
        scheme: https
        static_configs:
        - targets: ['127.0.0.1:14726']
        tls_config:
          cert_file: /var/vcap/jobs/otel-collector/config/certs/scrape.crt
          key_file: /var/vcap/jobs/otel-collector/config/certs/scrape.key
          ca_file: /var/vcap/jobs/otel-collector/config/certs/scrape_ca.crt
          server_name: <%= p('scrape.tls.server_name') %>

exporters: <%= YAML.dump(p('exporters')).sub("---", "").gsub("\n", "\n  ") %>

service:
  pipelines:
    metrics:
      receivers:
      - prometheus
      exporters: <%= YAML.dump(p('exporters').keys).sub("---", "").gsub("\n", "\n      ") %>
